# Story 2.1: Coin Detail Page

## Status

Draft

## Story

**As a** user,  
**I want** to view detailed information about a specific coin,  
**so that** I can make informed decisions about cryptocurrencies.

## Acceptance Criteria

1. The Coin Detail Page loads when clicking on a coin from the list or selecting from search
2. Page displays comprehensive coin information including price, market data, and statistics
3. Page is responsive and works on mobile and desktop devices
4. Loading and error states are properly handled
5. Navigation back to the main list is intuitive
6. Feature passes all related unit tests

## Tasks / Subtasks

**ðŸš¨ CRITICAL: Commit frequently! Each checkbox completion should be a separate commit. See git workflow section at the end for the recommended commit sequence.**

- [ ] Create `useCoinDetail.ts` hook for fetching coin data (AC: 2)
  - [ ] Implement SWR hook to fetch from `/coins/{id}` endpoint
  - [ ] Include market data, price changes, and description
  - [ ] Handle loading and error states
  - [ ] Add proper TypeScript types for coin detail data
  - [ ] Implement data caching strategy

- [ ] Update Coin Detail Page layout and structure (AC: 1, 2, 3)
  - [ ] Replace placeholder content with real coin data
  - [ ] Create header section with coin logo, name, symbol, and rank
  - [ ] Add current price display with 24h change indicator
  - [ ] Implement responsive grid layout for statistics
  - [ ] Add back navigation button/breadcrumb

- [ ] Create `CoinStats.tsx` component for market statistics (AC: 2, 3)
  - [ ] Display market cap with formatted numbers
  - [ ] Show 24h trading volume
  - [ ] Include circulating and total supply
  - [ ] Add all-time high/low prices with dates
  - [ ] Implement responsive card layout
  - [ ] Use consistent number formatting utilities

- [ ] Create `PriceChanges.tsx` component for price movements (AC: 2, 3)
  - [ ] Show price changes for multiple timeframes (24h, 7d, 30d, 1y)
  - [ ] Use color coding (green/red) for positive/negative changes
  - [ ] Display percentage and absolute value changes
  - [ ] Add visual indicators (arrows/icons)
  - [ ] Ensure accessibility with proper ARIA labels

- [ ] Implement loading and error states (AC: 4)
  - [ ] Create skeleton loader matching page layout
  - [ ] Design error component with retry functionality
  - [ ] Handle 404 errors for invalid coin IDs
  - [ ] Add loading shimmer effects for better UX
  - [ ] Implement graceful degradation for missing data

- [ ] Add coin description section (AC: 2)
  - [ ] Display coin description from API (with HTML parsing)
  - [ ] Implement "Read more/less" functionality for long descriptions
  - [ ] Add official website and social media links
  - [ ] Include category tags and platform information
  - [ ] Sanitize HTML content for security

- [ ] Create comprehensive unit tests (AC: 6)
  - [ ] Test coin detail page with various coin IDs
  - [ ] Test useCoinDetail hook with mock data
  - [ ] Test loading and error state rendering
  - [ ] Test navigation from list and search
  - [ ] Test responsive behavior
  - [ ] Test number formatting edge cases
  - [ ] Test HTML sanitization in descriptions
  - [ ] Ensure all tests pass with `npm run test`

- [ ] Code quality verification
  - [ ] Run `npm run lint` - all linting rules must pass
  - [ ] Run `npm run format:check` - all code must be properly formatted
  - [ ] Run `npm run type-check` - TypeScript compilation must succeed
  - [ ] Pre-commit hooks must be working and passing

- [ ] Follow git workflow standards - COMMIT FREQUENTLY!
  - [ ] **IMPORTANT**: Commit after EACH subtask completion (see `docs/git-workflow.md`)
  - [ ] Use conventional commit format: `(type)[coin-detail] summary`
  - [ ] Recommended commit sequence:
    - [ ] `(feat)[coin-detail] Create useCoinDetail hook with SWR integration`
    - [ ] `(feat)[coin-detail] Update coin detail page layout with header section`
    - [ ] `(feat)[coin-detail] Create CoinStats component for market statistics`
    - [ ] `(feat)[coin-detail] Create PriceChanges component with timeframe data`
    - [ ] `(feat)[coin-detail] Add loading skeleton and error states`
    - [ ] `(feat)[coin-detail] Implement coin description with read more functionality`
    - [ ] `(feat)[coin-detail] Add navigation and breadcrumb components`
    - [ ] `(test)[coin-detail] Add unit tests for coin detail page`
    - [ ] `(test)[coin-detail] Add unit tests for useCoinDetail hook`
    - [ ] `(fix)[coin-detail] Handle edge cases and missing data gracefully`
  - [ ] Each commit must leave code in working state
  - [ ] Run quality checks before EACH commit

## Dev Notes

### API Endpoint

[Source: docs/architecture/api-integration.md]

**Coin Detail Endpoint**: `GET /coins/{id}`

Parameters:

- `localization`: false (reduce payload size)
- `tickers`: false (not needed for basic view)
- `market_data`: true (required for prices)
- `community_data`: false
- `developer_data`: false
- `sparkline`: false

Example response structure:

```typescript
interface CoinDetailData {
  id: string;
  symbol: string;
  name: string;
  asset_platform_id: string | null;
  description: {
    en: string;
  };
  links: {
    homepage: string[];
    blockchain_site: string[];
    official_forum_url: string[];
    // ... more links
  };
  image: {
    thumb: string;
    small: string;
    large: string;
  };
  market_cap_rank: number;
  market_data: {
    current_price: { [key: string]: number };
    market_cap: { [key: string]: number };
    total_volume: { [key: string]: number };
    price_change_percentage_24h: number;
    price_change_percentage_7d: number;
    price_change_percentage_30d: number;
    price_change_percentage_1y: number;
    ath: { [key: string]: number };
    ath_date: { [key: string]: string };
    atl: { [key: string]: number };
    atl_date: { [key: string]: string };
    circulating_supply: number;
    total_supply: number;
    max_supply: number | null;
  };
  categories: string[];
  // ... more fields
}
```

### Component Architecture

- **Page Component**: `/src/app/[coinId]/page.tsx` (already exists, needs implementation)
- **Data Hook**: `/src/hooks/useCoinDetail.ts`
- **Sub-components**:
  - `/src/components/CoinDetailHeader.tsx` (logo, name, price)
  - `/src/components/CoinStats.tsx` (market statistics grid)
  - `/src/components/PriceChanges.tsx` (price change indicators)
  - `/src/components/CoinDescription.tsx` (about section)

### Design Considerations

1. **Mobile First**: Stack elements vertically on mobile, use grid on desktop
2. **Loading States**: Use skeleton screens that match final layout
3. **Error Handling**: Show specific messages for 404 vs network errors
4. **Performance**: Cache coin detail data with SWR for quick navigation
5. **Accessibility**: Proper heading hierarchy and ARIA labels

### Utility Functions Needed

- `formatCurrency()`: Format prices with proper decimals
- `formatMarketCap()`: Format large numbers (1.2T, 500B, etc.)
- `formatPercentage()`: Format percentage changes with +/- signs
- `sanitizeHTML()`: Safely parse description HTML

### Integration Points

- Navigation from `CoinCard` component (already implemented)
- Navigation from `SearchCommand` component (already implemented)
- Back navigation to home page with preserved filters/search

## Testing

### Test Scenarios

1. **Page Load**: Verify page loads with valid coin ID
2. **Invalid ID**: Test 404 handling for non-existent coins
3. **Data Display**: Verify all market data renders correctly
4. **Responsive**: Test layout on mobile/tablet/desktop
5. **Navigation**: Test navigation to/from detail page
6. **Loading**: Verify skeleton screens appear during load
7. **Error States**: Test network error handling and retry

### Mock Data

Use realistic mock data for tests including edge cases:

- Coins with no max supply (Bitcoin)
- Coins with very small prices (SHIB)
- Coins with missing description
- Coins with extreme price changes

## Change Log

| Date       | Version | Description            | Author    |
| ---------- | ------- | ---------------------- | --------- |
| 2025-08-05 | 1.0     | Initial story creation | John (PM) |

## Dev Agent Record

_This section will be populated by the development agent during implementation_

### Agent Model Used

_To be filled_

### Debug Log References

_To be filled_

### Completion Notes List

_To be filled_

### File List

_To be filled_

## QA Results

_This section will be populated by the QA agent after implementation review_
